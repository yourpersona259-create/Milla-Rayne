name: Run Gemini CLI

# This workflow will also create a pull request for any changes made by the workflow

on:
  workflow_dispatch:

jobs:
  run-gemini:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Gemini CLI to generate notificationService.ts
        uses: google-github-actions/run-gemini-cli@v0.1.12
        with:
          prompt: "Generate a TypeScript notification service (notificationService.ts) for proactive notifications using the SYNC Protocol."
          settings: |
            output_file: notificationService.ts
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      - name: Run Gemini CLI to generate scheduler.ts
        uses: google-github-actions/run-gemini-cli@v0.1.12
        with:
          prompt: "Generate a TypeScript scheduler (scheduler.ts) to work with the notification service for proactive notifications."
          settings: |
            output_file: scheduler.ts
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "feat: Implement Proactive Notification Service (SYNC Protocol)"
          title: "feat: Implement Proactive Notification Service (SYNC Protocol)"
          body: "This PR adds notificationService.ts and scheduler.ts generated by Gemini CLI."
          branch: "feat/notification-service"
